# 變身卷軸：HTML 與伺服器設定

## 1. 為何只有一種能變、其他顯示「無法變成你指定的怪物」

伺服器用 **名稱** 查變身表，且會檢查 **等級**。

- 客戶端從變身視窗點選連結時，送出的字串 = 該連結的 `action`（即 meta）。
- 伺服器 `L1PolyScroll.use(pc, item, s)` 用 `s` 查表：`PolyTable.getInstance().getTemplate(s)`。
- `PolyTable` 的 key 是資料庫表 **`polymorphs`** 的 **`name`** 欄位（字串，區分大小寫）。

因此：

- HTML 裡每個變身選項的 **連結 action 值必須與 DB 的 `polymorphs.name` 完全一致**（含大小寫、空格）。
- 若連結是中文名或顯示用名稱，而 DB 存的是英文 id/name，就會查不到，伺服器回 181：「無法變成你指定的怪物」。

**建議**：  
用伺服器 DB 的 `polymorphs` 表匯出 `name` 清單，在 `monlist-*.html` 裡用這些 **name** 當連結 action，顯示文字可另寫。例如：

```html
<a action="Orc">獸人</a>
<a action="Dragon">龍</a>
```

若 DB 的 name 是 `Orc`，action 就必須是 `Orc`，不能是 `orc` 或 `獸人`。

---

## 2. 變身等級限制（伺服器設定）

等級限制在 **資料庫**，不是在設定檔。

- **表**：`polymorphs`
- **欄位**：**`min_level`**
- **邏輯**：`L1PolyScroll.use()` 內為  
  `if (poly.getMinLevel() <= pc.getLevel() || pc.isGm())` 才允許變身，否則一樣回 181。

所以：

- **設定位置**：資料庫 `polymorphs` 表，每筆變身的 **`min_level`**。
- 若要某變身無等級限制，把該筆的 `min_level` 設為 0（或 ≤ 1）即可。
- GM 不受限制（`pc.isGm()` 為 true 時會通過）。

---

## 3. HTML 檔案位置與檔名

- 變身視窗讀取的基底檔名：**`monlist`**。
- 路徑：**`res://Assets/text/`**（對應專案目錄 `Assets/text/`）。
- 檔名會依語言加後綴，例如：`monlist-c.html`、`monlist-e.html`、`monlist-h.html`，或無後綴的 `monlist.html`。

若 **只有一種能變**：

1. 檢查 **`Assets/text/`** 下是否有 `monlist-c.html`（或你使用的語言後綴）。
2. 打開該檔，確認每個 `<a action="...">` 的 **action 值** 是否與 DB **`polymorphs.name`** 完全一致。
3. 檢查 DB **`polymorphs`** 表該變身的 **`min_level`** 是否高於角色等級。

---

## 4. 伺服器相關程式位置（jp 專案）

- 變身卷軸邏輯：`jp.l1j.server.model.item.executor.L1PolyScroll`（`use()` 內查 `PolyTable.getTemplate(s)`、檢查 `min_level`、送 181）。
- 變身表載入：`jp.l1j.server.datatables.PolyTable`（從 DB 表 `polymorphs` 讀取，key = `name`）。
- 訊息 181：`S_ServerMessage(181)` = 「無法變成你指定的怪物」。
